   
\documentclass[11pt]{article}
\renewcommand{\baselinestretch}{1.05}
\usepackage{amsmath,amsthm,verbatim,amssymb,amsfonts,amscd, graphicx}
\usepackage{graphics}
\topmargin0.0cm
\headheight0.0cm
\headsep0.0cm
\oddsidemargin0.0cm
\textheight23.0cm
\textwidth16.5cm
\footskip1.0cm
\theoremstyle{plain}
\newtheorem{theorem}{Theorem}
\newtheorem{corollary}{Corollary}
\newtheorem{lemma}{Lemma}
\newtheorem{proposition}{Proposition}
\newtheorem*{surfacecor}{Corollary 1}
\newtheorem{conjecture}{Conjecture} 
\newtheorem{question}{Question} 
\theoremstyle{definition}
\newtheorem{definition}{Definition}


%\newcommand{\log}{\textrm{log}}

 \begin{document}
 

\title{Temporal Model for Public Mood on Immigration}
\author{Dallas Card}
\maketitle

\section{Variables}

\begin{itemize}
\item Given $N$ articles $i = 1, ..., N$, each assigned to a time period $t$ (e.g. $1980_{Q1}$).
\item Each article has a \textit{primary tone} \{positive, neutral, anti\} and either uses or does not use each of $15$ \textit{framing dimensions}.
\item Let $t_i$ index the time period of article $i$.
\item Let $z_{ij} = 1$ if article $i$ uses framing dimension $j$; else $z_{ij}=0$
\item Let $v_{i} \in \{0,1,2\}$ be the tone of article $i$
\item Each article has associated annotations from a subset of $K$ annotators (including our classifiers):\
\begin{itemize}
\item Let $y_{ijk} = 1$ if annotator $k$ has annotated article $i$ with the $j^{th}$ framing dimension.
\item Let $u_{ik} \in \{0, 1, 2\}$ be the tone of article $i$ as annotated by annotator $k$.
\end{itemize}
\item Let $n_t'$ be the number of article published in time period $t$
\item Let $n_t = n_t' / \max_t n_t'$
\item Let $\theta_t \in \mathbb{R}^15$ be a latent vector associated with the framing of articles in time period $t$.
\item Let $F_{tj} = \exp ( -\exp(\theta_{tj})) \in [0,1]$ be the probability of an article in time period $t$ using framing dimension $j$.
\item Let $E_t$ be the sum of the entropies of $F_{tj}$ (fill in details)
\item Similarly, let $\phi_t \in \mathbb{R}^3$ be a latent variable associated with the tone of articles in time period $t$.
\item Let $T_{tl} = \exp(\phi_{tl}) / \sum_{l' = 0}^2 \exp(\phi_{tl'})$ be the probability of an article using tone $l$ in time period $t$.
\item Let $m_t \in [-1,1] $ be the public mood in time period $t$ (demeaned and rescaled)
\item Let $q_{jk} = p(y_{ijk}=1|z_{ij} = 1) $
\item Let $r_{jk} = p(y_{ijk}=0|z_{ij} = 0)$
\item Let $s_{kl} = p(u_{ik} | v_i = l)$
\end{itemize} 

\section{Generative Story}

\begin{itemize}
\item Let the latent framing variable, latent tone variable, and mood evolve slowly with time.
\item (!) $\sigma_f \sim U[0, 10]$
\item (!) $\sigma_t \sim U[0, 10]$
\item (!) $\sigma_m \sim U[0, 10]$
\item (!) $\sigma_w \sim U[0, 10]$
\item $w_f \sim \mathcal{N}(0, \sigma_w^2)$
\item $\theta_t \sim \mathcal{N}(\theta_{t-1}, \sigma_f^2)$
\item $\phi_t \sim \mathcal{N}(\phi_{t-1}, \sigma_t^2)$
\item $m_t \sim \mathcal{N}(\mathbf{w} \cdot \mathbf{x}, \sigma_m^2)$ where:
\begin{itemize}
\item (!) $x_0 = 1$
\item $x_1 = m_{t-1}$
\item $x_2 = n_t$
\item $x_3 = T_{t0} - T_{t2}$
\item $x_4 = x_2 \cdot x_3$
\item $x_5 = E_t$
\item $x_6 = x_2 \cdot x_5$
\end{itemize}
\item $z_{ij} = \textrm{Bernoulli}(F_{t_i j})$
\item (!) $\mu_{qj} = 
\item (!) $q_{jk} \sim \textrm{Beta}(\alpha_{qj}, \beta_{qj})$
\item (!) $r_{jk} \sim U[0.5, 1]$
\item $y_{ijk} = \textrm{Bernoulli}\left( q_{jk} \cdot \mathbb{I}[{z_{ij}}=1] + (1-r_{jk}) \cdot \mathbb{I}[z_{ij} = 0]\right)$
\item $v_{i} = \textrm{Multinomial}(T_{t_i})$
\item (!) $s_{kl} \sim \textrm{Dir}(1 + 2 \cdot \mathbb{I}[l])$
\item $u_{ik} = \textrm{Multnomial}(s_{k0} \cdot \mathbb{I}[v_i = 0] + s_{k1} \cdot \mathbb{I}[v_i = 1] + s_{k2} \cdot \mathbb{I}[v_i = 2]) $

\end{itemize}

\section{Sampling equations}

\begin{itemize}
\item Sampling $\theta$:
\end{itemize}
\begin{align*}
p(\theta_t &| \theta_{t-1}, \theta_{t+1}, m_t, \phi_t, n_t, m_{t-1}, \{z_i\}_{t_i=t}, w) \\
&\propto p(\theta_t, \theta_{t+1}, m_t, \{z_i\}_{t_i=t}| \theta_{t-1}, \phi_t, n_t, m_{t-1}, w) \\
&= p(\theta_t | \theta_{t-1}) p(\theta_{t+1}|\theta_t) p(m_t, | \theta_t, \phi_t, n_t, m_{t-1}, w) \prod_{i : t_i = t} p(\{z_i\} | \theta_{t_i})  \\
&= \mathcal{N}(\theta_t ; \theta_{t-1}, \sigma_f^2)  \mathcal{N}(\theta_{t+1} ; \theta_{t}, \sigma_f^2) \mathcal{N}(m_t ; w \cdot x, \sigma_m^2) \prod_{i : t_i = t} \prod_{j=1}^J \textrm{Ber}(z_{ij} ; F_{t_i j} )  \\
\end{align*}

\begin{itemize}
\item Sampling $\phi$:
\end{itemize}
\begin{align*}
p(\phi_t &| \phi_{t-1}, \phi_{t+1}, m_t, \theta_t, n_t, m_{t-1}, \{v_i\}_{t_i=t}, w) \\
&\propto p(\phi_t, \phi_{t+1}, m_t, \{v_i\}_{t_i=t}| \phi_{t-1}, \theta_t, n_t, m_{t-1}, w) \\
&= p(\phi_t | \phi_{t-1}) p(\phi_{t+1}|\phi_t) p(m_t, | \phi_t, \theta_t, n_t, m_{t-1}, w) \prod_{i : t_i = t} p(\{v_i\} | \phi_{t})  \\
&= \mathcal{N}(\phi_t ; \phi_{t-1}, \sigma_t^2)  \mathcal{N}(\phi_{t+1} ; \phi_{t}, \sigma_t^2) \mathcal{N}(m_t ; w \cdot x, \sigma_m^2) \prod_{i : t_i = t} \textrm{Mul}(v_i ; T_{t_i} )  \\
\end{align*}

\begin{itemize}
\item Sampling $z$:
\end{itemize}
\begin{align*}
p(z_{ij} &| \theta_{t_i}, \{y_{ijk}, q_{jk}, r_{jk}\}_{k \in K_i}) \\
&\propto p(z_{ij}, \{y_{ijk}\}_{k \in K_i} | \theta_{t_i}, \{q_{jk}, r_{jk}\}_{k \in K_i}) \\
&= p(z_{ij} | \theta_{t_i}) \prod_{k \in K_i} p(y_{ijk} | z_{ij}, q_{jk}, r_{jk}) \\
&= \textrm{Ber}(z_{ij} ; F_{t_i j} ) \prod_{k \in K_i} \textrm{Ber}(y_{ijk} ; q_{jk} \cdot \mathbb{I}[z_{ij}=1] + (1-r_{jk}) \cdot \mathbb{I}[z_{ij}=0])\\
\end{align*}

\begin{itemize}
\item Sampling $v$:
\end{itemize}
\begin{align*}
p(v_i &| \phi_{t_i}, \{u_{ik}, s_{k}\}_{k \in K_i}) \\
&\propto p(v_i, \{u_{ik}\}_{k \in K_i} | \phi_{t_i}, \{s_{k}\}_{k \in K_i}) \\
&= p(v_i | \phi_{t_i}) \prod_{k \in K_i} p(u_{ik} | v_i, s_{k}) \\
&= \textrm{Mul}(v_i ; T_{t_i j} ) \prod_{k \in K_i} \textrm{Mul}(u_{ik} ; s_{k0} \cdot \mathbb{I}[v_i = 0] + s_{k1} \cdot \mathbb{I}[v_i = 1] + s_{k2} \cdot \mathbb{I}[v_i = 2])\\
\end{align*}

\begin{itemize}
\item Sampling $q$:
\end{itemize}
\begin{align*}
p(q_{jk} &| r_{jk}, \{z_{ij}, y_{ijk}\}_{i \in I_k}) \\
&\propto p(q_{jk}, \{y_{ijk}\}_{i \in I_k} | r_{jk}, \{z_{ij}\}_{i \in I_k}) \\
&= p(q_{jk}) \prod_{i \in I_k} p(y_{ijk} | q_{jk}, r_{jk}, z_{ij}) \\
&= \textrm{U}(q_{jk} ; 0.5, 1) \prod_{i \in I_k} \textrm{Ber}(y_{ijk} ; q_{jk} \cdot \mathbb{I}[z_{ij}=1] + (1-r_{jk}) \cdot \mathbb{I}[z_{ij}=0])\\
\end{align*}


\begin{itemize}
\item Sampling $r$:
\end{itemize}
\begin{align*}
p(r_{jk} &| q_{jk}, \{z_{ij}, y_{ijk}\}_{i \in I_k}) \\
&\propto p(r_{jk}, \{y_{ijk}\}_{i \in I_k} | q_{jk}, \{z_{ij}\}_{i \in I_k}) \\
&= p(r_{jk}) \prod_{i \in I_k} p(y_{ijk} | q_{jk}, r_{jk}, z_{ij}) \\
&= \textrm{U}(r_{jk} ; 0.5, 1) \prod_{i \in I_k} \textrm{Ber}(y_{ijk} ; q_{jk} \cdot \mathbb{I}[z_{ij}=1] + (1-r_{jk}) \cdot \mathbb{I}[z_{ij}=0])\\
\end{align*}



\begin{itemize}
\item Sampling $s$:
\end{itemize}
\begin{align*}
p(s_{kl} &| \{v_i, u_{ik}\}_{i \in I_k}) \\
&\propto p(s_{kl}, \{u_{ik}\}_{i \in I_k} | \{v_i\}_{i \in I_k}) \\
&= p(s_{kl}) \prod_{i \in I_k} p(u_{ik} | s_{kl}, v_i) \\
&= \textrm{Dir}(s_{kl} ; ? ) \prod_{i \in I_k} \textrm{Mul}(u_{ik} ; s_{k0} \cdot \mathbb{I}[v_i = 0] + s_{k1} \cdot \mathbb{I}[v_i = 1] + s_{k2} \cdot \mathbb{I}[v_i = 2])\\
\end{align*}


\begin{itemize}
\item Sampling $w$:
\end{itemize}
\begin{align*}
p(w_{f} &| \{m_t, m_{t-1}, \theta_t, \phi_t, n_t\}_{t=1}^N, \sigma_w, \sigma_m) \\
&\propto p(w_f | \sigma_w) \prod_{t=1}^N p(m_t  | m_{t-1}, \theta_t, \phi_t, n_t, w, \sigma_m) \\
&= \mathcal{N}(w_f ; 0, \sigma_w^2) \prod_{t=1}^N \mathcal{N}(m_t ; w \cdot x , \sigma_m^2)
\end{align*}

\begin{itemize}
\item Sampling $q$:
\end{itemize}
\begin{align*}
p(q_{jk} 
\end{align*}

\section{Improvements}


\begin{itemize}
\item Use the probabilities from the classifiers, not the predictions, possibly generating probabilities as a mixture of Betas(?)
\item Better priors for sigmas (?)
\item Better (hierarchical?) priors for q, r and s
\item Better modeling of temporal dynamics
\item Newspaper-specific transformations of latent spaces (?); tendency to take a biased step in a latent space (?)
\end{itemize}
 
\end{document}
